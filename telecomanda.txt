#include <SPI.h>
#include <nRF24L01.h>
#include <RF24.h>
#include<DigitalIO.h>
//#include<AESLib.h>
#include <LCD_ST7032.h>

LCD_ST7032 lcd;
RF24 radio(5,6);
const byte addresses[6] = "00001";
int16_t value_x=0,value_y=0,value_sw = 0;
const int buttonPin = 10;
int buttonState ; 
void setup() { 
  Serial.begin(9600);
  SPI.begin();
  SPI.setClockDivider(2);
  pinMode(A0, INPUT);
  pinMode(A1, INPUT);
  pinMode(9, INPUT_PULLUP);
  digitalWrite(7,HIGH);
  digitalWrite(4,HIGH);
  pinMode(buttonPin, INPUT_PULLUP);
  digitalWrite(buttonPin, HIGH);
  lcd.begin();
  lcd.setcontrast(24);
  lcd.setCursor(0,0);
 
  
}

void loop() {
  radio.begin();
  radio.openWritingPipe(addresses);
  radio.setAutoAck(false);
  radio.setPALevel(RF24_PA_MAX);
  radio.setDataRate(RF24_1MBPS);
  radio.stopListening();
  delay(100);
  value_x = analogRead(A0); 
  value_y = analogRead(A1); 
  value_sw = digitalRead(2); 
  String text,s1,s2,s3,s4;
  buttonState = digitalRead(buttonPin);
  if(buttonState==HIGH){
  if(value_x<470){
    s3="c0";
    s4="d"+String(int(abs(value_x-470)/4.71));
  }else if(value_x>550) {
    s3="c"+String(int((value_x-550)/4.74));
    s4="d0";
  }else{
    s3="c0";
    s4="d0";
  }
  if(value_y<470){
    s1="a0";
    s2="b"+String(int(abs(value_y-470)/4.71));
  }else if(value_y>550){
    s1="a"+String(int((value_y-550)/4.74));
    s2="b0";
  }else{
    s1="a0";
    s2="b0";
  }
  text=s1+","+s2+","+s3+","+s4;
  char mesaj[32];
  text.toCharArray(mesaj, 32);
 // uint8_t key[] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31};
 // aes256_enc_single(key, mesaj);
  Serial.println(mesaj);
  radio.write(&mesaj, sizeof(mesaj));
  delay(500);
  }else{
    char a[32]="stop";
    //uint8_t key[] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31};
    //aes256_enc_single(key, a);
    radio.write(&a, sizeof(a));
    delay(100);
    radio.openReadingPipe(0,addresses);
    radio.startListening();
    delay(100);
    if(radio.available()){
      while(radio.available()){
      char text[32]="";
      radio.read(&text[0], sizeof(text));
     // uint8_t key[] = {0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31};
     // aes256_dec_single(key, text);
      String copie=text;
      Serial.println(copie);
      lcd.clear();
      lcd.print(copie);
      }
    }
    delay(100);
  }


}